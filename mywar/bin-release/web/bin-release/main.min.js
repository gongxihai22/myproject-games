var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var GameBeginPage=function(e){function t(){e.call(this),this.skinName="src/components/GameBeginPageSkin.exml",this.show_title_y=this.img_title.y,this.hide_title_y=-100,this.hide_text_y=1e3,this.img_texts=[],this.img_texts.push(this.img_text1),this.img_texts.push(this.img_text2),this.img_texts.push(this.img_text3),this.img_texts.push(this.img_text4),this.img_texts.push(this.img_text5),this.img_texts_pos=[];for(var t=0,i=0;i<this.img_texts.length;i++)t=this.img_texts[i].y,this.img_texts_pos[i]=t;this.btn_timer=new egret.Timer(400,0),this.btn_timer.addEventListener(egret.TimerEvent.TIMER,this.playBtnEffect,this),this.btn_enter_big.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterBtnOnClick,this),this.btn_enter_small.addEventListener(egret.TouchEvent.TOUCH_TAP,this.enterBtnOnClick,this),this.hideAll()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.ShowPage=function(e){this.hideAll(),e?(e.addChild(this),this.playTitleEffect(),this.playTextEffect()):console.log("首页父对象为空...")},n.HidePage=function(){this.parent&&this.parent.removeChild(this),this.hideAll()},n.enterBtnOnClick=function(){this.btn_enter_big.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.enterBtnOnClick,this),this.btn_enter_small.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.enterBtnOnClick,this),GameController.getInstance().GameSelect()},n.playTitleEffect=function(){var e=egret.Tween.get(this.img_title);e.to({y:this.show_title_y},500)},n.playTextEffect=function(){function e(){s+=1,s<i.length?(a=egret.Tween.get(n[s]),a.to({y:i[s]},1e3).call(e)):(t.btn_timer.start(),t.btn_enter_small.visible=!0)}var t=this,i=this.img_texts_pos,n=this.img_texts,s=0,a=egret.Tween.get(n[s]);a.to({y:i[s]},1e3).call(e)},n.playBtnEffect=function(){this.btn_enter_big.visible=!this.btn_enter_big.visible,this.btn_enter_small.visible=!this.btn_enter_small.visible},n.hideAll=function(){this.img_title.y=this.hide_title_y,this.btn_timer.stop();for(var e=0;e<this.img_texts.length;e++)this.img_texts[e].y=this.hide_text_y;this.btn_enter_big.visible=!1,this.btn_enter_small.visible=!1},t}(eui.Component);egret.registerClass(GameBeginPage,"GameBeginPage");var GameController=function(){function e(){}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.initGame=function(){this.gameBeginPage=new GameBeginPage,this.gameSelectPage=new GameSelectPage,this.gamePlayePage=new GamePlayPage,this.gameOverPage=new GameOverPage},i.GameEnter=function(e){this.initGame(),e&&(this.gameStage=e,this.gameSelectPage.ShowPage(e))},i.GameSelect=function(){this.gameBeginPage.HidePage(),this.gameSelectPage.ShowPage(this.gameStage)},i.GamePlay=function(e){this.gameSelectPage.HidePage(),this.gamePlayePage.SetElementId(e),this.gamePlayePage.ShowPage(this.gameStage)},i.GameOver=function(e,t){this.gamePlayePage.HidePage(),this.gameOverPage.ShowPage(e,this.gameStage,t)},i.GameRestartPlay=function(e){this.gameOverPage.HidePage(),e?this.gamePlayePage.RestartGame():this.gameSelectPage.ShowPage(this.gameStage)},i.GameVideoPlay=function(){this.gameOverPage.HidePage()},e}();egret.registerClass(GameController,"GameController");var GameLoadingPage=function(e){function t(){e.call(this),this.progressWidth=0,this.skinName="src/components/GameLoadingPageSkin.exml",this.progressWidth=this.loading_progress.width,this.loading_progress.width=0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setProgress=function(e,t){var i=Math.floor(e/t*100);this.loading_text.text=i.toString()+"%",this.loading_progress.width=e/t*this.progressWidth},t}(eui.Component);egret.registerClass(GameLoadingPage,"GameLoadingPage");var GameOverPage=function(e){function t(){e.call(this),this.isFailBeginBtn=!0,this.video_url="http://h5.twttmob.com/wodezhanzheng/mywar/mywar.html",this.skinName="src/components/GameOverPageSkin.exml",this.btn_fail_again0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnFailAgainOnClick,this),this.btn_fail_again1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnFailAgainOnClick,this),this.btn_success_again.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnSuccessAgainOnClick,this),this.btn_play_vedio0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnPlayVedioOnClick,this),this.btn_play_vedio1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btnPlayVedioOnClick,this),this.btn_timer=new egret.Timer(500,0),this.btn_timer.addEventListener(egret.TimerEvent.TIMER,this.btnTimerHandle,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.ShowPage=function(e,t,i){t&&(t.addChild(this),this.game_pic.source="game_pic"+e+"_jpg",this.hideAll(),i?this.playWinEffect():this.playFailEffect())},n.HidePage=function(){this.parent&&this.parent.removeChild(this)},n.playFailEffect=function(){function e(){n.stop(),n.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,e,this),n=null,this.img_fail.visible=!1,t.group_fail.visible=!1,t.btn_fail_again0.visible=!0,t.btn_fail_again1.visible=!1,t.btn_timer.start()}var t=this;this.group_fail.visible=!0,this.isFailBeginBtn=!0,this.img_fail.visible=!0,this.img_fail.scaleX=3,this.img_fail.scaleY=3;var i=egret.Tween.get(this.img_fail);i.to({scaleX:1,scaleY:1},2e3);var n=new egret.Timer(3e3,1);n.addEventListener(egret.TimerEvent.TIMER_COMPLETE,e,this),n.start()},n.playWinEffect=function(){function e(){n.stop(),n.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,e,this),n=null,this.img_success.visible=!1,t.group_win.visible=!1,t.btn_play_vedio0.visible=!0,t.btn_play_vedio1.visible=!1,t.btn_success_again.visible=!0,t.btn_timer.start()}var t=this;this.group_win.visible=!0,this.isFailBeginBtn=!1,this.img_success.visible=!0,this.img_success.scaleX=.5,this.img_success.scaleY=.5;var i=egret.Tween.get(this.img_success);i.to({scaleX:1,scaleY:1},500);var n=new egret.Timer(3e3,1);n.addEventListener(egret.TimerEvent.TIMER_COMPLETE,e,this),n.start()},n.btnTimerHandle=function(){this.isFailBeginBtn?(this.btn_fail_again0.visible=!this.btn_fail_again0.visible,this.btn_fail_again1.visible=!this.btn_fail_again1.visible):(this.btn_play_vedio0.visible=!this.btn_play_vedio0.visible,this.btn_play_vedio1.visible=!this.btn_play_vedio1.visible)},n.btnFailAgainOnClick=function(){this.btn_timer.stop(),GameController.getInstance().GameRestartPlay(!0)},n.btnSuccessAgainOnClick=function(){this.btn_timer.stop(),GameController.getInstance().GameRestartPlay(!1)},n.btnPlayVedioOnClick=function(){window.location.href=this.video_url},n.hideAll=function(){this.group_win.visible=!1,this.group_fail.visible=!1,this.btn_fail_again0.visible=!1,this.btn_fail_again1.visible=!1,this.btn_play_vedio0.visible=!1,this.btn_play_vedio1.visible=!1,this.btn_success_again.visible=!1,this.img_success.visible=!1,this.img_fail.visible=!1},t}(eui.Component);egret.registerClass(GameOverPage,"GameOverPage");var GamePlayElement=function(e){function t(){e.call(this),this.game_play_id=0,this.skinName="src/components/GamePlayElementSkin.exml",this.btn_game_img=this.btn_game_element.getChildAt(0)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.SetElementId=function(e,t){this.game_play_id=t,this.btn_game_img?this.btn_game_img.source="element"+e+"_"+t+"_jpg":console.log("获取按钮图片属性失败。")},n.GetElementId=function(){return this.game_play_id},t}(eui.Button);egret.registerClass(GamePlayElement,"GamePlayElement");var GamePlayPage=function(e){function t(){e.call(this),this.game_timer_count=0,this.gameTime=20,this.gameDelay=3800,this.touchState=!1,this.skinName="src/components/GamePlayPageSkin.exml",this.gameReadyTipPage=new GameReadyTipPage,this.game_timer=new egret.Timer(1e3,0),this.distance=new egret.Point}__extends(t,e);var i=(__define,t),n=i.prototype;return n.ShowPage=function(e){e&&(this.currentStage=e,e.addChild(this),this.addChild(this.gameReadyTipPage),this.gameReadyTipPage.PlayEffect(),this.delay_timer=new egret.Timer(this.gameDelay,1),this.delay_timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.delayTimeComplete,this),this.delay_timer.start())},n.HidePage=function(){this.parent&&this.parent.removeChild(this),this.SetNum(0),this.game_pic.visible=!0},n.SetElementId=function(e){this.gameId=e,this.game_pic.source="game_pic"+e+"_jpg",this.game_pic.visible=!0},n.RestartGame=function(){this.currentStage.addChild(this),this.addChild(this.gameReadyTipPage),this.gameReadyTipPage.PlayEffect(),this.delay_timer=new egret.Timer(this.gameDelay,1),this.delay_timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.delayTimeComplete,this),this.delay_timer.start()},n.gameStart=function(){this.game_timer.addEventListener(egret.TimerEvent.TIMER,this.gameTimeHandle,this),this.game_timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.gameTimeCompleteHandle,this),this.game_timer_count=0,this.SetNum(this.game_timer_count),this.game_timer.reset(),this.game_timer.repeatCount=this.gameTime,this.game_timer.start(),this.currentPos=new egret.Point,this.targetPos=new egret.Point,this.game_pic.visible=!1,this.showGameElement()},n.showGameElement=function(){this.gameElementArr=new Array,this.gameElementPosArr=new Array;for(var e=0;9>e;e++){var t=new egret.Point;t.x=64+e%3*164,t.y=222+210*Math.floor(e/3);var i=new GamePlayElement;i.x=t.x,i.y=t.y,i.SetElementId(this.gameId,e+1),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.elementTouchBegin,this),i.addEventListener(egret.TouchEvent.TOUCH_END,this.elementTouchEnd,this),this.group_play_bg.addChild(i),this.group_play_bg.setChildIndex(i,10),this.gameElementArr.push(i),this.gameElementPosArr.push(t)}this.randElementPos()},n.elementTouchBegin=function(e){var t=e.target;this.currentElement=t,this.moveElement=new GamePlayElement,this.moveElement.SetElementId(this.gameId,t.GetElementId()),this.group_play_bg.addChild(this.moveElement),this.moveElement.x=t.x,this.moveElement.y=t.y,this.moveElement.touchEnabled=!1,this.group_play_bg.setChildIndex(this.moveElement,9),this.group_play_bg.setChildIndex(t,100),this.currentPos.x=t.x,this.currentPos.y=t.y,this.touchState=!0,this.distance.x=e.stageX-t.x,this.distance.y=e.stageY-t.y,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.elementMove,this)},n.elementMove=function(e){this.touchState&&(this.currentElement.x=e.stageX-this.distance.x,this.currentElement.y=e.stageY-this.distance.y)},n.elementTouchEnd=function(e){var t=e.target;this.group_play_bg.setChildIndex(t,10),this.setHitElementPos(e.stageX,e.stageY,t),this.moveElement&&this.moveElement.parent&&(this.moveElement.parent.removeChild(this.moveElement),this.moveElement=null),this.touchState=!1,this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.elementMove,this),this.checkWin()&&this.gameOver(!0)},n.setHitElementPos=function(e,t,i){for(var n=!1,s=0;s<this.gameElementArr.length;s++)if(this.gameElementArr[s].hitTestPoint(e,t)&&this.gameElementArr[s].GetElementId()!=this.currentElement.GetElementId()){this.targetPos.x=this.gameElementArr[s].x,this.targetPos.y=this.gameElementArr[s].y;for(var a=0;a<this.gameElementArr.length;a++)this.gameElementArr[a].x==this.targetPos.x&&this.gameElementArr[a].y==this.targetPos.y&&(this.gameElementArr[a].x=this.currentPos.x,this.gameElementArr[a].y=this.currentPos.y,i.x=this.targetPos.x,i.y=this.targetPos.y);n=!0}n||(i.x=this.currentPos.x,i.y=this.currentPos.y)},n.checkWin=function(){for(var e=0;e<this.gameElementPosArr.length;e++)if(this.gameElementPosArr[e].x!=this.gameElementArr[e].x||this.gameElementPosArr[e].y!=this.gameElementArr[e].y)return!1;return!0},n.gameOver=function(e){this.game_timer.stop(),this.game_timer.removeEventListener(egret.TimerEvent.TIMER,this.gameTimeHandle,this),this.game_timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.gameTimeCompleteHandle,this),GameController.getInstance().GameOver(this.gameId,e),this.removeAllElement(),this.moveElement&&this.moveElement.parent&&(this.moveElement.parent.removeChild(this.moveElement),this.moveElement=null),this.gameElementArr=null,this.gameElementPosArr=null},n.randElementPos=function(){for(var e=this.gameElementArr.length,t=new egret.Point,i=0;i<this.gameElementArr.length;i++){var n=Math.floor(Math.random()*e);t.x=this.gameElementArr[n].x,t.y=this.gameElementArr[n].y,this.gameElementArr[n].x=this.gameElementArr[i].x,this.gameElementArr[n].y=this.gameElementArr[i].y,this.gameElementArr[i].x=t.x,this.gameElementArr[i].y=t.y}},n.removeAllElement=function(){for(var e=0;e<this.gameElementArr.length;e++)this.gameElementArr[e].parent&&(this.gameElementArr[e].removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.elementTouchBegin,this),this.gameElementArr[e].removeEventListener(egret.TouchEvent.TOUCH_END,this.elementTouchEnd,this),this.gameElementArr[e].parent.removeChild(this.gameElementArr[e]))},n.delayTimeComplete=function(){this.delay_timer.stop(),this.delay_timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.delayTimeComplete,this),this.delay_timer=null,this.gameStart()},n.gameTimeHandle=function(){this.game_timer_count+=1,this.SetNum(this.game_timer_count)},n.gameTimeCompleteHandle=function(){this.gameOver(this.checkWin())},n.SetNum=function(e){var t=parseInt((e/10).toString()),i=parseInt((e%10).toString());this.time_num_0.source="time_num_"+t.toString()+"_png",this.time_num_1.source="time_num_"+i.toString()+"_png"},t}(eui.Component);egret.registerClass(GamePlayPage,"GamePlayPage");var GameReadyTipPage=function(e){function t(){e.call(this),this.ready_count=2e3,this.go_count=2e3,this.skinName="src/components/GameReadyTipPageSkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.PlayEffect=function(){var e=this,i=egret.Tween.get(this.tip_ready),n=egret.Tween.get(this.tip_go);this.tip_ready.scaleX=t.BIG_SCALE,this.tip_ready.scaleY=t.BIG_SCALE,this.tip_ready.alpha=1,this.tip_go.scaleY=t.SMALL_SCALE,this.tip_go.scaleX=t.SMALL_SCALE,this.tip_go.alpha=0,i.to({scaleX:t.SMALL_SCALE,scaleY:t.SMALL_SCALE,alpha:0},this.ready_count),n.wait(1e3).to({scaleX:t.BIG_SCALE,scaleY:t.BIG_SCALE,alpha:1},this.go_count).call(function(){e.parent&&e.parent.removeChild(e)})},t.BIG_SCALE=3,t.SMALL_SCALE=.1,t}(eui.Component);egret.registerClass(GameReadyTipPage,"GameReadyTipPage");var GameSelectElement=function(e){function t(){e.call(this),this.select_id=0,this.skinName="src/components/GameSelectElementSkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.Init=function(e,t){this.select_id=e,this.select_img.source="game_pic"+e+"_jpg",this.IsSelect(t)},n.IsSelect=function(e){this.select_bg.visible=e},n.GetElementId=function(){return this.select_id},t}(eui.Component);egret.registerClass(GameSelectElement,"GameSelectElement");var GameSelectPage=function(e){function t(){e.call(this),this.skinName="src/components/GameSelectPageSkin.exml",this.elementArr=new Array;for(var t=0;4>t;t++){var i=new GameSelectElement;i.Init(t+1,!1),i.x=85+t%2*230,i.y=210+260*Math.floor(t/2),this.select_bg.addChild(i),this.elementArr.push(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.elementOnClick,this)}this.enterGameTimer=new egret.Timer(800,1),this.enterGameTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.enterGameTimerComplete,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.ShowPage=function(e){this.cancelAllSelect(),e&&(e.addChild(this),this.elementArr[0].IsSelect(!0))},n.HidePage=function(){this.parent&&(this.parent.removeChild(this),this.enterGameTimer.stop())},n.elementOnClick=function(e){var t=e.target.parent;this.cancelAllSelect(),t.IsSelect(!0),this.currentGameElementId=t.GetElementId(),this.enterGameTimer.reset(),this.enterGameTimer.repeatCount=1,this.enterGameTimer.start()},n.enterGameTimerComplete=function(){this.enterGameTimer.stop(),GameController.getInstance().GamePlay(this.currentGameElementId)},n.cancelAllSelect=function(){for(var e=0;e<this.elementArr.length;e++)this.elementArr[e].IsSelect(!1)},t}(eui.Component);egret.registerClass(GameSelectPage,"GameSelectPage");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},n.onThemeLoadComplete=function(){RES.loadGroup("loading"),this.createScene()},n.onResourceLoadComplete=function(e){"loading"==e.groupName&&(this.loadingPage=new GameLoadingPage,this.stage.addChild(this.loadingPage),RES.loadGroup("preload"),this.isThemeLoadEnd=!0),"preload"==e.groupName&&(this.stage.removeChild(this.loadingPage),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingPage.setProgress(e.itemsLoaded,e.itemsTotal)},n.startCreateScene=function(){console.log("the MyWar Game is begining."),GameController.getInstance().GameEnter(this)},n.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);